# Тест-кейсы для приложения Vacation Scheduler

## 1. Аутентификация (`AuthHandler`)

| ID    | Название                                  | Шаги                                                                 | Ожидаемый результат                                                                 | Роль        | Тип       | Приоритет |
| :---- | :---------------------------------------- | :------------------------------------------------------------------- | :---------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| AUTH-01 | Успешный вход пользователя              | 1. Отправить POST /login с валидными `username` и `password`.        | 1. Статус 200 OK. 2. В ответе есть `token` и `user` (без пароля).                 | Любая       | Позитивный | Высокий   |
| AUTH-02 | Вход с неверным паролем                 | 1. Отправить POST /login с валидным `username` и неверным `password`. | 1. Статус 401 Unauthorized. 2. Сообщение об ошибке (например, "Неверный пароль"). | Любая       | Негативный | Высокий   |
| AUTH-03 | Вход с несуществующим пользователем     | 1. Отправить POST /login с несуществующим `username`.                | 1. Статус 401 Unauthorized. 2. Сообщение об ошибке (например, "Пользователь не найден"). | Любая       | Негативный | Высокий   |
| AUTH-04 | Вход с пустыми данными                  | 1. Отправить POST /login с пустым `username` или `password`.         | 1. Статус 400 Bad Request. 2. Сообщение об ошибке валидации.                      | Любая       | Негативный | Средний   |
| AUTH-05 | Вход с некорректным форматом запроса    | 1. Отправить POST /login с некорректным JSON.                        | 1. Статус 400 Bad Request. 2. Сообщение об ошибке парсинга JSON.                  | Любая       | Негативный | Средний   |

## 2. Лимиты отпусков (`AppHandler`)

| ID    | Название                                     | Шаги                                                                                                | Ожидаемый результат                                                                                                | Роль        | Тип       | Приоритет |
| :---- | :------------------------------------------- | :-------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| LIMIT-01 | Получение своего лимита отпуска             | 1. Авторизоваться. 2. Отправить GET /vacations/limits/{year} с корректным годом.                    | 1. Статус 200 OK. 2. В ответе JSON с `user_id`, `year`, `total_days`, `used_days`.                               | User        | Позитивный | Высокий   |
| LIMIT-02 | Получение лимита с некорректным годом       | 1. Авторизоваться. 2. Отправить GET /vacations/limits/abc.                                          | 1. Статус 400 Bad Request. 2. Сообщение "Некорректный формат года".                                                | User        | Негативный | Средний   |
| LIMIT-03 | Получение лимита без авторизации            | 1. Отправить GET /vacations/limits/{year}.                                                          | 1. Статус 401 Unauthorized.                                                                                        | -           | Негативный | Высокий   |
| LIMIT-04 | Установка лимита администратором (успешно) | 1. Авторизоваться как Admin. 2. Отправить POST /admin/vacations/limits с `user_id`, `year`, `total_days`. | 1. Статус 200 OK. 2. Сообщение "Лимит отпуска успешно установлен". 3. Лимит в БД обновлен.                          | Admin       | Позитивный | Высокий   |
| LIMIT-05 | Установка лимита не администратором       | 1. Авторизоваться как User/Manager. 2. Отправить POST /admin/vacations/limits.                      | 1. Статус 403 Forbidden. 2. Сообщение "Доступ запрещен. Требуются права администратора".                           | User/Manager| Негативный | Высокий   |
| LIMIT-06 | Установка лимита с некорректными данными    | 1. Авторизоваться как Admin. 2. Отправить POST /admin/vacations/limits с отсутствующими полями.      | 1. Статус 400 Bad Request. 2. Сообщение об ошибке валидации.                                                       | Admin       | Негативный | Средний   |
| LIMIT-07 | Установка лимита с отрицательными днями   | 1. Авторизоваться как Admin. 2. Отправить POST /admin/vacations/limits с `total_days` < 0.          | 1. Статус 500 Internal Server Error (или 400, если валидация в сервисе). 2. Сообщение об ошибке. Лимит не изменен. | Admin       | Негативный | Средний   |

## 3. Заявки на отпуск (`AppHandler`)

### 3.1 Создание и отправка

| ID     | Название                                     | Шаги                                                                                                                                                              | Ожидаемый результат                                                                                                                                                            | Роль        | Тип       | Приоритет |
| :----- | :------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| REQ-C-01 | Успешное создание заявки (черновик)          | 1. Авторизоваться. 2. Отправить POST /vacations/requests с корректными `year`, `periods` (start_date, end_date, days_count), `comment`.                             | 1. Статус 201 Created. 2. В ответе JSON созданной заявки со статусом "Черновик" (ID=1) и присвоенным ID. 3. Заявка и периоды сохранены в БД.                               | User        | Позитивный | Высокий   |
| REQ-C-02 | Создание заявки с некорректными датами       | 1. Авторизоваться. 2. Отправить POST /vacations/requests с `end_date` < `start_date`.                                                                             | 1. Статус 400 Bad Request. 2. Сообщение об ошибке валидации дат.                                                                                                               | User        | Негативный | Высокий   |
| REQ-C-03 | Создание заявки с пересекающимися периодами  | 1. Авторизоваться. 2. Отправить POST /vacations/requests с двумя периодами, которые пересекаются.                                                                 | 1. Статус 400 Bad Request. 2. Сообщение об ошибке валидации (пересечение периодов).                                                                                            | User        | Негативный | Средний   |
| REQ-C-04 | Создание заявки без авторизации              | 1. Отправить POST /vacations/requests.                                                                                                                            | 1. Статус 401 Unauthorized.                                                                                                                                                    | -           | Негативный | Высокий   |
| REQ-C-05 | Создание заявки с некорректным JSON          | 1. Авторизоваться. 2. Отправить POST /vacations/requests с невалидным JSON.                                                                                       | 1. Статус 400 Bad Request. 2. Сообщение об ошибке парсинга/декодирования.                                                                                                      | User        | Негативный | Средний   |
| REQ-S-01 | Успешная отправка заявки на рассмотрение     | 1. Авторизоваться. 2. Создать заявку (REQ-C-01). 3. Отправить POST /vacations/requests/{id}/submit, где {id} - ID созданной заявки.                               | 1. Статус 200 OK. 2. Сообщение "Заявка успешно отправлена руководителю". 3. Статус заявки в БД изменен на "На рассмотрении" (ID=2). 4. (Опционально) Создано уведомление менеджеру. | User        | Позитивный | Высокий   |
| REQ-S-02 | Отправка несуществующей заявки               | 1. Авторизоваться. 2. Отправить POST /vacations/requests/999/submit.                                                                                              | 1. Статус 500 Internal Server Error (или 404, если сервис обрабатывает). 2. Сообщение об ошибке (заявка не найдена).                                                            | User        | Негативный | Средний   |
| REQ-S-03 | Отправка чужой заявки                        | 1. Авторизоваться как User A. 2. User B создает заявку. 3. User A пытается отправить заявку User B (POST /vacations/requests/{user_b_req_id}/submit).             | 1. Статус 500 Internal Server Error (или 403). 2. Сообщение об ошибке (нет прав).                                                                                              | User        | Негативный | Высокий   |
| REQ-S-04 | Повторная отправка уже отправленной заявки   | 1. Авторизоваться. 2. Создать и отправить заявку (REQ-S-01). 3. Повторно отправить POST /vacations/requests/{id}/submit.                                          | 1. Статус 500 Internal Server Error (или 400). 2. Сообщение об ошибке (неверный статус заявки).                                                                               | User        | Негативный | Средний   |

### 3.2 Получение заявок

| ID     | Название                                     | Шаги                                                                                                                            | Ожидаемый результат                                                                                                                                                            | Роль        | Тип       | Приоритет |
| :----- | :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| REQ-G-01 | Получение своих заявок за год                | 1. Авторизоваться. 2. Создать несколько заявок в разные годы. 3. Отправить GET /vacations/my?year={year}.                       | 1. Статус 200 OK. 2. В ответе массив заявок пользователя только за указанный год.                                                                                              | User        | Позитивный | Высокий   |
| REQ-G-02 | Получение своих заявок без авторизации       | 1. Отправить GET /vacations/my?year={year}.                                                                                     | 1. Статус 401 Unauthorized.                                                                                                                                                    | -           | Негативный | Высокий   |
| REQ-G-03 | Получение своих заявок с некорректным годом  | 1. Авторизоваться. 2. Отправить GET /vacations/my?year=abc.                                                                     | 1. Статус 400 Bad Request. 2. Сообщение "Некорректный формат года".                                                                                                            | User        | Негативный | Средний   |
| REQ-G-04 | Получение заявок отдела (менеджер)           | 1. Авторизоваться как Manager отдела X. 2. Сотрудники отдела X создают заявки. 3. Отправить GET /manager/departments/{id}/vacations?year={year}. | 1. Статус 200 OK. 2. В ответе массив заявок сотрудников отдела X за указанный год.                                                                                            | Manager     | Позитивный | Высокий   |
| REQ-G-05 | Получение заявок отдела (не менеджер)        | 1. Авторизоваться как User. 2. Отправить GET /manager/departments/{id}/vacations?year={year}.                                   | 1. Статус 403 Forbidden. 2. Сообщение "Доступ запрещен. Требуются права руководителя".                                                                                         | User        | Негативный | Высокий   |
| REQ-G-06 | Получение заявок чужого отдела (менеджер)    | 1. Авторизоваться как Manager отдела X. 2. Отправить GET /manager/departments/{id_отдела_Y}/vacations?year={year}.               | 1. Статус 403 Forbidden (если проверка в сервисе) или пустой массив (если фильтрация по ID менеджера).                                                                         | Manager     | Негативный | Высокий   |
| REQ-G-07 | Получение всех заявок (админ)                | 1. Авторизоваться как Admin. 2. Отправить GET /admin/vacations/all?year={year}.                                                 | 1. Статус 200 OK. 2. В ответе массив всех заявок всех пользователей за указанный год.                                                                                          | Admin       | Позитивный | Высокий   |
| REQ-G-08 | Получение всех заявок (менеджер)             | 1. Авторизоваться как Manager отдела X. 2. Отправить GET /admin/vacations/all?year={year}.                                      | 1. Статус 200 OK (или 403, если менеджер не может видеть все). 2. В ответе массив заявок только своего отдела (или ошибка, если доступ запрещен).                               | Manager     | Пограничный| Высокий   |
| REQ-G-09 | Получение всех заявок (пользователь)         | 1. Авторизоваться как User. 2. Отправить GET /admin/vacations/all?year={year}.                                                  | 1. Статус 403 Forbidden. 2. Сообщение об ошибке прав доступа.                                                                                                                  | User        | Негативный | Высокий   |
| REQ-G-10 | Получение всех заявок с фильтрами (админ)    | 1. Авторизоваться как Admin. 2. Отправить GET /admin/vacations/all?year={y}&status={s}&userId={u}&departmentId={d}.             | 1. Статус 200 OK. 2. В ответе массив заявок, отфильтрованный по всем указанным параметрам.                                                                                    | Admin       | Позитивный | Средний   |
| REQ-G-11 | Получение всех заявок с некорректными фильтрами | 1. Авторизоваться как Admin. 2. Отправить GET /admin/vacations/all?year=abc.                                                  | 1. Статус 200 OK (если год по умолчанию) или 400 Bad Request (если год обязателен и невалиден). 2. Результат зависит от обработки невалидных фильтров (игнор или ошибка). | Admin       | Негативный | Средний   |

### 3.3 Изменение статуса (Отмена, Утверждение, Отклонение)

| ID     | Название                                     | Шаги                                                                                                                                                              | Ожидаемый результат                                                                                                                                                            | Роль        | Тип       | Приоритет |
| :----- | :------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| REQ-X-01 | Отмена своей заявки (Черновик)               | 1. Авторизоваться. 2. Создать заявку (REQ-C-01). 3. Отправить POST /vacations/requests/{id}/cancel.                                                              | 1. Статус 200 OK. 2. Сообщение "Заявка успешно отменена". 3. Статус заявки в БД изменен на "Отменена" (ID=5).                                                                 | User        | Позитивный | Высокий   |
| REQ-X-02 | Отмена своей заявки (На рассмотрении)        | 1. Авторизоваться. 2. Создать и отправить заявку (REQ-S-01). 3. Отправить POST /vacations/requests/{id}/cancel.                                                  | 1. Статус 200 OK. 2. Сообщение "Заявка успешно отменена". 3. Статус заявки в БД изменен на "Отменена" (ID=5).                                                                 | User        | Позитивный | Высокий   |
| REQ-X-03 | Отмена чужой заявки (пользователь)           | 1. Авторизоваться как User A. 2. User B создает заявку. 3. User A пытается отменить заявку User B (POST /vacations/requests/{user_b_req_id}/cancel).               | 1. Статус 403 Forbidden. 2. Сообщение "нет прав на отмену этой заявки".                                                                                                       | User        | Негативный | Высокий   |
| REQ-X-04 | Отмена утвержденной заявки (пользователь)    | 1. Авторизоваться. 2. Создать, отправить, утвердить заявку. 3. Отправить POST /vacations/requests/{id}/cancel.                                                    | 1. Статус 400 Bad Request. 2. Сообщение "нельзя отменить заявку в статусе 'Утверждена'".                                                                                       | User        | Негативный | Средний   |
| REQ-A-01 | Утверждение заявки (менеджер)                | 1. Авторизоваться как Manager. 2. Сотрудник отдела отправляет заявку. 3. Отправить POST /manager/vacations/requests/{id}/approve.                                 | 1. Статус 200 OK. 2. Сообщение "Заявка успешно утверждена". 3. Статус заявки в БД = "Утверждена" (ID=3). 4. `used_days` в `vacation_limits` увеличен. 5. Уведомление сотруднику. | Manager     | Позитивный | Высокий   |
| REQ-A-02 | Утверждение заявки (админ)                   | 1. Авторизоваться как Admin. 2. Любой сотрудник отправляет заявку. 3. Отправить POST /manager/vacations/requests/{id}/approve.                                    | 1. Статус 200 OK. 2. Сообщение "Заявка успешно утверждена". 3. Статус заявки в БД = "Утверждена" (ID=3). 4. `used_days` в `vacation_limits` увеличен. 5. Уведомление сотруднику. | Admin       | Позитивный | Высокий   |
| REQ-A-03 | Утверждение заявки (пользователь)            | 1. Авторизоваться как User. 2. Отправить заявку. 3. Попытаться утвердить свою же заявку POST /manager/vacations/requests/{id}/approve.                             | 1. Статус 403 Forbidden. 2. Сообщение "недостаточно прав для утверждения этой заявки".                                                                                        | User        | Негативный | Высокий   |
| REQ-A-04 | Утверждение заявки не своего отдела (менеджер)| 1. Авторизоваться как Manager отдела X. 2. Сотрудник отдела Y отправляет заявку. 3. Попытаться утвердить заявку POST /manager/vacations/requests/{req_Y_id}/approve. | 1. Статус 403 Forbidden. 2. Сообщение "недостаточно прав для утверждения этой заявки".                                                                                        | Manager     | Негативный | Высокий   |
| REQ-A-05 | Утверждение уже утвержденной заявки          | 1. Авторизоваться как Manager/Admin. 2. Утвердить заявку. 3. Повторно отправить POST /manager/vacations/requests/{id}/approve.                                    | 1. Статус 400 Bad Request. 2. Сообщение "можно утвердить только заявку в статусе 'На рассмотрении'".                                                                          | Manager/Adm | Негативный | Средний   |
| REQ-A-06 | Утверждение заявки при нехватке дней         | 1. Авторизоваться как Manager/Admin. 2. Установить `used_days` = `total_days`. 3. Сотрудник отправляет заявку. 4. Попытаться утвердить POST /manager/vacations/requests/{id}/approve. | 1. Статус 400 Bad Request. 2. Сообщение "недостаточно дней отпуска у сотрудника".                                                                                             | Manager/Adm | Негативный | Высокий   |
| REQ-R-01 | Отклонение заявки (менеджер)                 | 1. Авторизоваться как Manager. 2. Сотрудник отдела отправляет заявку. 3. Отправить POST /manager/vacations/requests/{id}/reject с опциональным `reason`.           | 1. Статус 200 OK. 2. Сообщение "Заявка успешно отклонена". 3. Статус заявки в БД = "Отклонена" (ID=4). 4. Уведомление сотруднику с причиной (если указана).                   | Manager     | Позитивный | Высокий   |
| REQ-R-02 | Отклонение заявки (админ)                    | 1. Авторизоваться как Admin. 2. Любой сотрудник отправляет заявку. 3. Отправить POST /manager/vacations/requests/{id}/reject с опциональным `reason`.              | 1. Статус 200 OK. 2. Сообщение "Заявка успешно отклонена". 3. Статус заявки в БД = "Отклонена" (ID=4). 4. Уведомление сотруднику с причиной (если указана).                   | Admin       | Позитивный | Высокий   |
| REQ-R-03 | Отклонение заявки (пользователь)             | 1. Авторизоваться как User. 2. Отправить заявку. 3. Попытаться отклонить свою же заявку POST /manager/vacations/requests/{id}/reject.                              | 1. Статус 403 Forbidden. 2. Сообщение "недостаточно прав для отклонения этой заявки".                                                                                         | User        | Негативный | Высокий   |
| REQ-R-04 | Отклонение заявки не своего отдела (менеджер)| 1. Авторизоваться как Manager отдела X. 2. Сотрудник отдела Y отправляет заявку. 3. Попытаться отклонить заявку POST /manager/vacations/requests/{req_Y_id}/reject.  | 1. Статус 403 Forbidden. 2. Сообщение "недостаточно прав для отклонения этой заявки".                                                                                         | Manager     | Негативный | Высокий   |
| REQ-R-05 | Отклонение уже отклоненной заявки            | 1. Авторизоваться как Manager/Admin. 2. Отклонить заявку. 3. Повторно отправить POST /manager/vacations/requests/{id}/reject.                                     | 1. Статус 400 Bad Request. 2. Сообщение "можно отклонить только заявку в статусе 'На рассмотрении'".                                                                           | Manager/Adm | Негативный | Средний   |

## 4. Пересечения отпусков (`AppHandler`)

| ID    | Название                                     | Шаги                                                                                                                            | Ожидаемый результат                                                                                                                                                            | Роль        | Тип       | Приоритет |
| :---- | :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| INT-01 | Получение пересечений (менеджер)             | 1. Авторизоваться как Manager отдела X. 2. Создать и утвердить несколько пересекающихся заявок в отделе X. 3. Отправить GET /manager/vacations/intersections?departmentId={id_X}&year={year}. | 1. Статус 200 OK. 2. В ответе структура данных с информацией о пересечениях (например, список сотрудников и дат).                                                              | Manager     | Позитивный | Высокий   |
| INT-02 | Получение пересечений (не менеджер)          | 1. Авторизоваться как User. 2. Отправить GET /manager/vacations/intersections?departmentId={id}&year={year}.                    | 1. Статус 403 Forbidden. 2. Сообщение "Доступ запрещен. Требуются права руководителя".                                                                                         | User        | Негативный | Высокий   |
| INT-03 | Получение пересечений без ID отдела          | 1. Авторизоваться как Manager. 2. Отправить GET /manager/vacations/intersections?year={year}.                                   | 1. Статус 400 Bad Request. 2. Сообщение "Некорректный ID подразделения".                                                                                                       | Manager     | Негативный | Средний   |
| INT-04 | Получение пересечений с некорректным годом   | 1. Авторизоваться как Manager. 2. Отправить GET /manager/vacations/intersections?departmentId={id}&year=abc.                    | 1. Статус 400 Bad Request. 2. Сообщение "Некорректный формат года".                                                                                                            | Manager     | Негативный | Средний   |

## 5. Управление пользователями (`AppHandler`)

| ID    | Название                                     | Шаги                                                                                                                            | Ожидаемый результат                                                                                                                                                            | Роль        | Тип       | Приоритет |
| :---- | :------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------ | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---------- | :-------- | :-------- |
| USER-L-01 | Получение списка пользователей с лимитами (админ) | 1. Авторизоваться как Admin. 2. Отправить GET /admin/users/limits?year={year}.                                                  | 1. Статус 200 OK. 2. В ответе массив пользователей с их лимитами (`total_days`, `used_days`) за указанный год.                                                                  | Admin       | Позитивный | Высокий   |
| USER-L-02 | Получение списка пользователей (не админ)    | 1. Авторизоваться как User/Manager. 2. Отправить GET /admin/users/limits?year={year}.                                           | 1. Статус 403 Forbidden. 2. Сообщение "Доступ запрещен. Требуются права администратора".                                                                                      | User/Manager| Негативный | Высокий   |
| USER-L-03 | Получение списка пользователей без года      | 1. Авторизоваться как Admin. 2. Отправить GET /admin/users/limits.                                                              | 1. Статус 400 Bad Request. 2. Сообщение "Параметр 'year' обязателен".                                                                                                          | Admin       | Негативный | Средний   |
| USER-L-04 | Получение списка с некорректным годом      | 1. Авторизоваться как Admin. 2. Отправить GET /admin/users/limits?year=abc.                                                     | 1. Статус 400 Bad Request. 2. Сообщение "Некорректный формат года".                                                                                                            | Admin       | Негативный | Средний   |

**Примечание:** Эти тест-кейсы основаны на анализе `handlers.go` и `db_schema.sql`. Они предполагают наличие соответствующей логики в сервисах (`vacationService`, `userService`, `authService`) и middleware для проверки прав доступа (`isAdmin`, `isManager`, `userID` в контексте). Для полного покрытия может потребоваться анализ кода сервисов и middleware.
