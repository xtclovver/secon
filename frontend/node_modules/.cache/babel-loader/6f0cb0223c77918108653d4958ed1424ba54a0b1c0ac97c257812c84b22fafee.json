{"ast":null,"code":"import axios from 'axios';\n\n// Получаем базовый URL API из переменных окружения или используем дефолтный\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8080/api';\n\n// Создание экземпляра axios с базовым URL\nconst authApi = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Перехватчик для добавления токена к запросам\nauthApi.interceptors.request.use(config => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    config.headers['Authorization'] = `Bearer ${token}`;\n  }\n  return config;\n}, error => {\n  return Promise.reject(error);\n});\n\n// Перехватчик для обработки ошибок ответа\nauthApi.interceptors.response.use(response => response, error => {\n  // Обработка 401 Unauthorized (например, истекший токен)\n  if (error.response && error.response.status === 401) {\n    // Удаляем старый токен и данные пользователя\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    // Перенаправляем на страницу логина, если мы не на ней\n    if (window.location.pathname !== '/login') {\n      window.location.href = '/login';\n    }\n  }\n  // Возвращаем ошибку для дальнейшей обработки\n  return Promise.reject(error);\n});\n\n/**\n * Преобразует объект пользователя от бэкенда (snake_case) в формат фронтенда (camelCase).\n * @param {Object} backendUser - Объект пользователя с бэкенда.\n * @returns {Object|null} - Преобразованный объект пользователя или null.\n */\nconst transformUserKeys = backendUser => {\n  if (!backendUser) return null;\n\n  // Создаем новый объект, чтобы не мутировать исходный\n  const frontendUser = {\n    ...backendUser\n  };\n\n  // Преобразуем is_admin в isAdmin\n  if (frontendUser.hasOwnProperty('is_admin')) {\n    frontendUser.isAdmin = frontendUser.is_admin;\n    delete frontendUser.is_admin; // Удаляем старый ключ\n  }\n\n  // Преобразуем is_manager в isManager\n  if (frontendUser.hasOwnProperty('is_manager')) {\n    frontendUser.isManager = frontendUser.is_manager;\n    delete frontendUser.is_manager; // Удаляем старый ключ\n  }\n\n  // Добавьте здесь преобразование других ключей при необходимости\n  // Например: frontendUser.fullName = frontendUser.full_name; delete frontendUser.full_name;\n\n  return frontendUser;\n};\n\n/**\n * Авторизация пользователя\n * @param {string} username - Имя пользователя\n * @param {string} password - Пароль\n * @returns {Promise<Object>} - Объект с данными пользователя и токеном\n */\nexport const login = async (username, password) => {\n  try {\n    const response = await authApi.post('/auth/login', {\n      username,\n      password\n    });\n    // Сохраняем токен и данные пользователя в localStorage при успешном входе\n    if (response.data && response.data.token) {\n      localStorage.setItem('token', response.data.token);\n    }\n    if (response.data && response.data.user) {\n      localStorage.setItem('user', JSON.stringify(response.data.user));\n    }\n    return response.data;\n  } catch (error) {\n    // Обработка ошибок от сервера\n    if (error.response && error.response.data && error.response.data.error) {\n      throw new Error(error.response.data.error);\n    } else if (error.request) {\n      // Ошибка сети или сервер недоступен\n      throw new Error('Не удалось подключиться к серверу. Проверьте ваше соединение.');\n    } else {\n      // Другие ошибки\n      throw new Error('Произошла неизвестная ошибка при входе.');\n    }\n  }\n};\n\n/**\n * Выход из системы\n */\nexport const logout = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('user');\n  // Перенаправляем на страницу логина\n  window.location.href = '/login';\n};\n\n/**\n * Получение информации о текущем пользователе (если есть токен)\n * @returns {Promise<Object|null>} - Объект с данными пользователя или null\n */\nexport const getCurrentUser = async () => {\n  // Проверяем наличие токена перед запросом\n  if (!isAuthenticated()) {\n    return null;\n  }\n  try {\n    const response = await authApi.get('/auth/me'); // Предполагаем, что есть такой эндпоинт\n    // Обновляем данные пользователя в localStorage\n    if (response.data) {\n      localStorage.setItem('user', JSON.stringify(response.data));\n    }\n    return response.data;\n  } catch (error) {\n    // Не бросаем ошибку, если это 401 (токен невалиден), просто возвращаем null\n    if (error.response && error.response.status !== 401) {\n      console.error('Ошибка получения данных пользователя:', error);\n      // Можно выбросить ошибку для других статусов, если нужно\n      // throw new Error(error.response?.data?.error || 'Ошибка получения данных пользователя');\n    }\n    // Если токен невалиден или другая ошибка, считаем пользователя неавторизованным\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    return null;\n  }\n};\n\n/**\n * Проверка наличия валидного токена в localStorage\n * @returns {boolean} - true, если токен есть\n */\nexport const isAuthenticated = () => {\n  return !!localStorage.getItem('token');\n  // В более сложном случае можно проверять срок действия токена\n};\n\n// Экспорт экземпляра axios для возможного использования в других API-клиентах\nexport default authApi;","map":{"version":3,"names":["axios","API_URL","process","env","REACT_APP_API_URL","authApi","create","baseURL","headers","interceptors","request","use","config","token","localStorage","getItem","error","Promise","reject","response","status","removeItem","window","location","pathname","href","transformUserKeys","backendUser","frontendUser","hasOwnProperty","isAdmin","is_admin","isManager","is_manager","login","username","password","post","data","setItem","user","JSON","stringify","Error","logout","getCurrentUser","isAuthenticated","get","console"],"sources":["/Users/usedcvnt/Documents/IDEProjects/VSCProjects/1st/frontend/src/api/auth.js"],"sourcesContent":["import axios from 'axios';\n\n// Получаем базовый URL API из переменных окружения или используем дефолтный\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:8080/api';\n\n// Создание экземпляра axios с базовым URL\nconst authApi = axios.create({\n  baseURL: API_URL,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Перехватчик для добавления токена к запросам\nauthApi.interceptors.request.use(\n  config => {\n    const token = localStorage.getItem('token');\n    if (token) {\n      config.headers['Authorization'] = `Bearer ${token}`;\n    }\n    return config;\n  },\n  error => {\n    return Promise.reject(error);\n  }\n);\n\n// Перехватчик для обработки ошибок ответа\nauthApi.interceptors.response.use(\n  response => response,\n  error => {\n    // Обработка 401 Unauthorized (например, истекший токен)\n    if (error.response && error.response.status === 401) {\n      // Удаляем старый токен и данные пользователя\n      localStorage.removeItem('token');\n      localStorage.removeItem('user');\n      // Перенаправляем на страницу логина, если мы не на ней\n      if (window.location.pathname !== '/login') {\n         window.location.href = '/login';\n      }\n    }\n    // Возвращаем ошибку для дальнейшей обработки\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Преобразует объект пользователя от бэкенда (snake_case) в формат фронтенда (camelCase).\n * @param {Object} backendUser - Объект пользователя с бэкенда.\n * @returns {Object|null} - Преобразованный объект пользователя или null.\n */\nconst transformUserKeys = (backendUser) => {\n  if (!backendUser) return null;\n  \n  // Создаем новый объект, чтобы не мутировать исходный\n  const frontendUser = { ...backendUser }; \n\n  // Преобразуем is_admin в isAdmin\n  if (frontendUser.hasOwnProperty('is_admin')) {\n    frontendUser.isAdmin = frontendUser.is_admin;\n    delete frontendUser.is_admin; // Удаляем старый ключ\n  }\n\n  // Преобразуем is_manager в isManager\n  if (frontendUser.hasOwnProperty('is_manager')) {\n    frontendUser.isManager = frontendUser.is_manager;\n    delete frontendUser.is_manager; // Удаляем старый ключ\n  }\n  \n  // Добавьте здесь преобразование других ключей при необходимости\n  // Например: frontendUser.fullName = frontendUser.full_name; delete frontendUser.full_name;\n\n  return frontendUser;\n};\n\n\n/**\n * Авторизация пользователя\n * @param {string} username - Имя пользователя\n * @param {string} password - Пароль\n * @returns {Promise<Object>} - Объект с данными пользователя и токеном\n */\nexport const login = async (username, password) => {\n  try {\n    const response = await authApi.post('/auth/login', { username, password });\n    // Сохраняем токен и данные пользователя в localStorage при успешном входе\n    if (response.data && response.data.token) {\n        localStorage.setItem('token', response.data.token);\n    }\n     if (response.data && response.data.user) {\n        localStorage.setItem('user', JSON.stringify(response.data.user));\n    }\n    return response.data;\n  } catch (error) {\n    // Обработка ошибок от сервера\n    if (error.response && error.response.data && error.response.data.error) {\n      throw new Error(error.response.data.error);\n    } else if (error.request) {\n      // Ошибка сети или сервер недоступен\n      throw new Error('Не удалось подключиться к серверу. Проверьте ваше соединение.');\n    } else {\n      // Другие ошибки\n      throw new Error('Произошла неизвестная ошибка при входе.');\n    }\n  }\n};\n\n/**\n * Выход из системы\n */\nexport const logout = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('user');\n  // Перенаправляем на страницу логина\n  window.location.href = '/login';\n};\n\n/**\n * Получение информации о текущем пользователе (если есть токен)\n * @returns {Promise<Object|null>} - Объект с данными пользователя или null\n */\nexport const getCurrentUser = async () => {\n  // Проверяем наличие токена перед запросом\n  if (!isAuthenticated()) {\n    return null;\n  }\n  \n  try {\n    const response = await authApi.get('/auth/me'); // Предполагаем, что есть такой эндпоинт\n    // Обновляем данные пользователя в localStorage\n    if (response.data) {\n       localStorage.setItem('user', JSON.stringify(response.data));\n    }\n    return response.data;\n  } catch (error) {\n    // Не бросаем ошибку, если это 401 (токен невалиден), просто возвращаем null\n    if (error.response && error.response.status !== 401) {\n      console.error('Ошибка получения данных пользователя:', error);\n      // Можно выбросить ошибку для других статусов, если нужно\n      // throw new Error(error.response?.data?.error || 'Ошибка получения данных пользователя');\n    }\n    // Если токен невалиден или другая ошибка, считаем пользователя неавторизованным\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    return null;\n  }\n};\n\n/**\n * Проверка наличия валидного токена в localStorage\n * @returns {boolean} - true, если токен есть\n */\nexport const isAuthenticated = () => {\n  return !!localStorage.getItem('token');\n  // В более сложном случае можно проверять срок действия токена\n};\n\n// Экспорт экземпляра axios для возможного использования в других API-клиентах\nexport default authApi;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}